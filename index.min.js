(function(){
"use strict";
var ElementList=function(e){return utils.extend(new EventDispatcher([EventNames.CHANGED]),{_selector:e,_elements:null,_watchableProperties:null,_init:function(){this._elements=[];this._watchableProperties=[];observer.on(EventNames.REMOVED,this._onChanged.bind(this));observer.on(EventNames.ADDED,this._onChanged.bind(this));observer.on(EventNames.ATTRIBUTES,this._onChanged.bind(this));observer.on(EventNames.RESIZED,this._onChanged.bind(this));this.sync();return this},_onChanged:function(e){var t=this._getChanges();t.length&&this.trigger(EventNames.CHANGED,t)},_getChanges:function(){var e=[];for(var t=0;t<this._elements.length;t++){var n=this._elements[t];var i=n.getChanges();i&&e.push(i)}return e},watchProperties:function(e){e=Array.isArray(e)?e:[e];this._watchableProperties=utils.concatUnique(this._watchableProperties,e);this._getChanges()},sync:function(){var e=document.querySelectorAll(this._selector);this._elements=[];for(var t=0;t<e.length;t++){var n=e[t];var i=Element.register(n,this._watchableProperties);this._elements.push(i)}this.length=this._elements.length},hasElement:function(e){for(var t=0;t<this._elements.length;t++){var n=this._elements[t].element;if(n==e){return true}}return false}})._init()};var Element=function(e,t){return{element:e,_properties:t||[],_snapshot:null,_init:function(){this._snapshot=this._getSnapshot();return this},getChanges:function(){var e=this._diff();this._snapshot=this._getSnapshot();return e},_diff:function(){var e={target:this.element,items:[]};for(var t=0;t<this._properties.length;t++){var n=this._properties[t];var i=this._getPropertyDiff(n);i&&e.items.push(i)}return e.items.length?e:null},_getPropertyDiff:function(e){var t=this.element[e];var n=this._snapshot[e];if(t!==n){return{property:e,value:t,oldValue:n}}},_getSnapshot:function(){var e={};for(var t=0;t<this._properties.length;t++){var n=this._properties[t];var i=this.element[n];e[n]=this.element[n]}return e}}._init()};Element._domElements=[];Element.elements=[];Element.register=function(e,t){if(this._domElements.indexOf(e)===-1){this._domElements.push(e);this.elements.push(new Element(e,t))}var n=this.elements.filter(utils.filterByProperty.bind(this,"element",e)).pop();return this.elements.filter(utils.filterByProperty.bind(this,"element",e)).pop()};var EventDispatcher=function(e){return{_allowedEventNames:e,_eventCallbacks:[],on:function(e,t){this._validateEventName(e);this._eventCallbacks.push({eventName:e,callback:t});return this},trigger:function(e){this._validateEventName(e);var t=Array.prototype.slice.call(arguments,1);for(var n=0;n<this._eventCallbacks.length;n++){var i=this._eventCallbacks[n];if(i.eventName==e){if(i.callback.constructor==Array){for(var r=0;r<i.callback.length;r++){i.callback[r].apply(this,t)}}else{i.callback.apply(this,t)}}}return this},hasEventListener:function(e){for(var t=0;t<this._eventCallbacks.length;t++){var n=this._eventCallbacks[t];if(n.eventName==e){return true}}return false},_validateEventName:function(e){if(this._allowedEventNames&&this._allowedEventNames.indexOf(e)===-1){throw new Error(e+" is not a valid event name.")}}}};var EventNames={MUTATION:"mutation",ADDED:"added",REMOVED:"removed",ATTRIBUTES:"attributes",CHANGED:"changed",RESIZED:"resized",all:[],_init:function(){for(var e in this){var t=this[e];if(typeof t=="string"){this.all.push(t)}}return this}}._init();window.Element&&function(e){e.matchesSelector=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){var t=this,n=(t.parentNode||t.document).querySelectorAll(e),i=-1;while(n[++i]&&n[i]!=t);return!!n[i]}}(Element.prototype);var ObserverData=function(e){return{options:utils.extend({mutations:null,event:null},e),types:[],_init:function(){this.types=this._getTypes();return this},_getTypes:function(){var e=[];e=e.concat(this._getMutationsTypes());e=e.concat(this._getEventType());return e},_getMutationsTypes:function(){var e=this.options.mutations||[];var t=[];e.forEach(function(e){if(this._mutationContainsAdded(e)&&t.indexOf("added")===-1){t.push("added")}if(this._mutationContainsRemoved(e)&&t.indexOf("removed")===-1){t.push("removed")}if(this._mutationContainsAttributes(e)&&t.indexOf("attributes")===-1){t.push("attributes")}}.bind(this));return t},_getEventType:function(){if(this.options.event){return this.options.event.type}return[]},_mutationContainsAdded:function(e){return e.addedNodes.length},_mutationContainsRemoved:function(e){return e.removedNodes.length},_mutationContainsAttributes:function(e){return e.type=="attributes"},hasType:function(e){return this.types.indexOf(e)!==-1},getAttributeChanges:function(e){var t=this.options.mutations;var n=[];for(var i=0;i<t.length;i++){var r=t[i];if(r.type=="attributes"&&e.indexOf(r.attributeName)!==-1){n.push({target:r.target,attributeName:r.attributeName,oldValue:r.oldValue})}}return n},getAddedElements:function(){return this._getMutatedElements("addedNodes")},getRemovedElements:function(){return this._getMutatedElements("removedNodes")},_getMutatedElements:function(e){var t=[];var n=this.options.mutations;for(var i=0;i<n.length;i++){var r=n[i];var s=r[e];if(e=="removedNodes"){var a=document.implementation.createDocument("http://www.w3.org/1999/xhtml","html",null);var o=document.createElementNS("http://www.w3.org/1999/xhtml","html");a.documentElement.appendChild(o);var l=a.createElement("body");o.appendChild(l);var u=r.target.cloneNode(false);l.appendChild(u)}if(s){for(var h=0;h<s.length;h++){var c=s[h];if(e=="removedNodes"){c=u.appendChild(c)}if(c.nodeType==Node.ELEMENT_NODE){t.push(c);if(c.childElementCount>0){var m=c.querySelectorAll("*");for(var v=0;v<m.length;v++){var d=m[v];d.nodeType==Node.ELEMENT_NODE&&t.push(d)}}}}}}return t}}._init()};var Observer=function(){return utils.extend(new EventDispatcher(EventNames.all),{observer:undefined,_resizeListener:null,_mutationObserverConfig:{attributes:true,attributeFilter:["class","style"],attributeOldValue:true,childList:true,subtree:true,characterData:true},_init:function(){this._resizeListener=this._getEventDispatcher.bind(this,"resized");this.observer=new MutationObserver(this._onMutations.bind(this));return this},_getEventDispatcher:function(e,t){utils.requestAnimationFrame.bind(window,this._eventCallback.bind(this,e,t))()},_eventCallback:function(e,t){var n=new ObserverData({event:t});this.trigger(e,n)},_onMutations:function(e){var t=new ObserverData({mutations:e});this.trigger(EventNames.MUTATION,t);for(var n=0;n<t.types.length;n++){var i=t.types[n];this.trigger(i,t)}},connect:function(){this.observer.observe(document.documentElement,this._mutationObserverConfig);window.addEventListener("resize",this._resizeListener)},disconnect:function(){this.observer.disconnect();window.removeEventListener("resize",this._resizeListener)}})._init()};var Query=function(e,t){var n=new EventDispatcher;return utils.extend(n,{_super:n,selector:e,elementList:null,_watchableAttributes:null,_init:function(){this.elementList=new ElementList(this.selector);this._watchableAttributes=[];t.on(EventNames.REMOVED,[this._syncElements.bind(this),this._onRemoved.bind(this)]);t.on(EventNames.ADDED,[this._syncElements.bind(this),this._onAdded.bind(this)]);t.on(EventNames.ATTRIBUTES,[this._onAttributes.bind(this)]);return this},on:function(e,n){t.observer.takeRecords();this._super.on(e,n)},_syncElements:function(){this.elementList.sync()},_onRemoved:function(e){var t=e.getRemovedElements().filter(this._filterMatchingElements.bind(this));t.length&&this.trigger(EventNames.REMOVED,t)},_onAdded:function(e){var t=e.getAddedElements().filter(this.elementList.hasElement.bind(this.elementList)).filter(this._filterMatchingElements.bind(this));t.length&&this.trigger(EventNames.ADDED,t)},_onAttributes:function(e){var t=this.elementList._elements;this.elementList.sync();var n=this.elementList;var i=e.getAttributeChanges(this._watchableAttributes).filter(function(e){return n.hasElement(e.target)});i.length&&this.trigger(EventNames.ATTRIBUTES,i);var r=this.elementList._elements;var s=r.filter(function(e){for(var n=0;n<t.length;n++){if(t[n].element==e.element){return false}}return true});s.length&&this.trigger(EventNames.ADDED,s)},find:function(){return Array.prototype.slice.call(document.querySelectorAll(this.selector))},watchAttributes:function(e){e=Array.isArray(e)?e:[e];this._watchableAttributes=utils.concatUnique(this._watchableAttributes,e)},_filterMatchingElements:function(e){return e.matches(this.selector)}})._init()};Query._selectors=[];Query.queries=[];Query.register=function(e,t){if(this._selectors.indexOf(e)===-1){this._selectors.push(e);this.queries.push(new Query(e,t))}var n=this.queries.filter(utils.filterByProperty.bind(this,"selector",e)).pop();return this.queries.filter(utils.filterByProperty.bind(this,"selector",e)).pop()};var utils={filterByProperty:function(e,t,n){return n[e]==t},concatUnique:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(e.indexOf(i)===-1){e.push(i)}}return e},isInDom:function(e){var t=e;while(t.parentNode){t=t.parentNode}return t==document},requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},extend:function(e,t){var n=Object.create(e);Object.keys(t).map(function(e){n[e]=t[e]});return n}};var observer=new Observer;observer.connect();window.elementObserver=function(e){var t=Query.register(e,observer);return{find:function(e){e(t.find());return this},added:function(e){t.on(EventNames.ADDED,e);return this},removed:function(e){t.on(EventNames.REMOVED,e);return this},attribute:function(e,n){t.watchAttributes(e);t.on(EventNames.ATTRIBUTES,function(t){var i=t.filter(function(t){return e.indexOf(t.attributeName)!==-1});i.length&&n(i)});return this},changed:function(e,n){t.elementList.watchProperties(e);t.elementList.on(EventNames.CHANGED,function(t){var i=t.filter(function(t){for(var n=0;n<t.items.length;n++){if(e.indexOf(t.items[n].property)!==-1){return t}}return false});console.log("___",i[0].target,i[0].items[0],i[0].items[0].value==i[0].items[0].oldValue);if(!i[0].target.removeAttribute){console.log("1",this.element)}i.length&&n(i)});return this}}};elementObserver.connect=observer.connect.bind(observer);elementObserver.disconnect=observer.disconnect.bind(observer);
})();