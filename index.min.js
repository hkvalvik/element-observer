(function(){
"use strict";
var Element=function(e,t){return{element:e,_properties:t,_snapshot:null,_init:function(){this._snapshot=this._getSnapshot();return this},getChanges:function(e){this._properties=e;var t=this._diff();this._snapshot=this._getSnapshot();return t},_diff:function(){var e={target:this.element,items:[]};for(var t=0;t<this._properties.length;t++){var n=this._properties[t];var i=this._getPropertyDiff(n);i&&e.items.push(i)}return e.items.length?e:null},_getPropertyDiff:function(e){var t=this.element[e];var n=this._snapshot[e];if(t!==n){return{property:e,value:t,oldValue:n}}},_getSnapshot:function(){var e={};for(var t=0;t<this._properties.length;t++){var n=this._properties[t];var i=this.element[n];e[n]=this.element[n]}return e}}._init()};var EventDispatcher=function(){return{_eventCallbacks:[],on:function(e,t){this._eventCallbacks.push({eventName:e,callback:t})},trigger:function(e){var t=Array.prototype.slice.call(arguments,1);for(var n=0;n<this._eventCallbacks.length;n++){var i=this._eventCallbacks[n];if(i.eventName==e){i.callback.apply(this,t)}}},hasEventListener:function(e){for(var t=0;t<this._eventCallbacks.length;t++){var n=this._eventCallbacks[t];if(n.eventName==e){return true}}return false}}};var ObserverData=function(e){return{options:utils.extend({mutations:null,event:null},e),_types:[],_init:function(){this._types=this._getTypes();return this._serialize()},_serialize:function(){return utils.extend({hasType:this._hasType.bind(this)},this.options)},_getTypes:function(){var e=[];e=e.concat(this._getMutationsTypes());if(this.options.event){}return e},_getMutationsTypes:function(){var e=this.options.mutations||[];var t=[];e.forEach(function(e){if(this._mutationContainsAdded(e)&&t.indexOf("added")===-1){t.push("added")}if(this._mutationContainsRemoved(e)&&t.indexOf("removed")===-1){t.push("removed")}if(this._mutationContainsAttributes(e)&&t.indexOf("attributes")===-1){t.push("attributes")}}.bind(this));return t},_mutationContainsAdded:function(e){return e.addedNodes.length},_mutationContainsRemoved:function(e){return e.removedNodes.length},_mutationContainsAttributes:function(e){return e.type=="attributes"},_hasType:function(e){return this._types.indexOf(e)!==-1}}._init()};var Observer=function(e){return{observer:undefined,_resizeListener:null,_mutationObserverConfig:{attributes:true,attributeOldValue:true,childList:true,subtree:true,characterData:true},_init:function(){this._resizeListener=utils.requestAnimationFrame.bind(window,this._onResize.bind(this));this.observer=new MutationObserver(this._onMutations.bind(this));this.connect();return this},_onResize:function(t){var n=new ObserverData({event:t});e(n)},_onMutations:function(t){var n=new ObserverData({mutations:t});e(n)},connect:function(){this.observer.observe(document.documentElement,this._mutationObserverConfig);window.addEventListener("resize",this._resizeListener)},disconnect:function(){this.observer.disconnect();window.removeEventListener("resize",this._resizeListener)}}._init()};var Query=function(e){return utils.extend(new EventDispatcher,{selector:e,_elements:undefined,_watchableProperties:undefined,_watchableAttributes:undefined,_init:function(){this._elements=[];this._watchableProperties=[];this._watchableAttributes=[];return this},find:function(){return Array.prototype.slice.call(document.querySelectorAll(this.selector))},watchProperties:function(e){e=Array.isArray(e)?e:[e];this._watchableProperties=utils.concatUnique(this._watchableProperties,e)},watchAttributes:function(e){e=Array.isArray(e)?e:[e];this._watchableAttributes=utils.concatUnique(this._watchableAttributes,e)},update:function(e){var t=e.types;if(e.hasType("removed")){var n=this._updateRemovedElements();n.length&&this.trigger("removed",n.map(this._getElement.bind(this)))}if(this._elements.length&&this.hasEventListener("change")){var i=this._getChanges();i.length&&this.trigger("change",i)}if(e.hasType("added")){var r=this._updateAddedElements();r.length&&this.trigger("added",r.map(this._getElement.bind(this)))}if(e.hasType("attributes")){var s=this._getAttributeChanges(e.mutations);s.length&&this.trigger("attribute",s)}},_getChanges:function(){var e=[];for(var t=0;t<this._elements.length;t++){var n=this._elements[t];var i=n.getChanges(this._watchableProperties);i&&e.push(i)}return e},_updateRemovedElements:function(){var e=this._elements.filter(function(e){return!utils.isInDom(e.element)});this._elements=this._elements.filter(function(e){return utils.isInDom(e.element)});return e},_updateAddedElements:function(){var t=Array.prototype.slice.call(document.querySelectorAll(e));var n=this._elements.map(this._getElement.bind(this));t=t.filter(function(e){return n.indexOf(e)===-1});t=t.map(function(e){return new Element(e,this._watchableProperties,this.selector)}.bind(this));this._elements=this._elements.concat(t);return t},_getAttributeChanges:function(e){var t=[];for(var n=0;n<e.length;n++){var i=e[n];if(i.type=="attributes"&&this._watchableAttributes.indexOf(i.attributeName)!==-1){var r=this._elements.map(this._getElement.bind(this));if(r.indexOf(i.target)!==-1){t.push({target:i.target,attributeName:i.attributeName,oldValue:i.oldValue})}}}return t},_getElement:function(e){return e.element}})._init()};Query._selectors=[];Query.queries=[];Query.register=function(e){if(this._selectors.indexOf(e)===-1){this._selectors.push(e);this.queries.push(new Query(e))}var t=this.queries.filter(utils.filterByProperty.bind(this,"selector",e)).pop();return this.queries.filter(utils.filterByProperty.bind(this,"selector",e)).pop()};var utils={filterByProperty:function(e,t,n){return n[e]==t},concatUnique:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(e.indexOf(i)===-1){e.push(i)}}return e},isInDom:function(e){var t=e;while(t.parentNode){t=t.parentNode}return t==document},requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},extend:function(e,t){var n=Object.create(e);Object.keys(t).map(function(e){n[e]=t[e]});return n}};var observer=new Observer(function(e){Query.queries.forEach(updateQuery.bind(this,e))});function updateQuery(e,t){t.update(e)}window.elementObserver=function(e){var t=Query.register(e);return{find:function(e){e(t.find());return this},added:function(e){t._updateAddedElements();t.on("added",e);return this},removed:function(e){t._updateAddedElements();t.on("removed",e);return this},attribute:function(e,n){t._updateAddedElements();t.watchAttributes(e);t.on("attribute",function(t){var i=t.filter(function(t){return e.indexOf(t.attributeName)!==-1});i.length&&n(i)});return this},change:function(e,n){t._updateAddedElements();t.watchProperties(e);t.on("change",function(t){var i=t.filter(function(t){for(var n=0;n<t.items.length;n++){if(e.indexOf(t.items[n].property)!==-1){return t}}return false});i.length&&n(i)});return this}}};elementObserver.connect=observer.connect.bind(observer);elementObserver.disconnect=observer.disconnect.bind(observer);
})();